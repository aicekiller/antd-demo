<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<div id='title'></div>
<div id='content'></div>
<script>
    function renderApp(appState) {
        renderTitle(appState.title)
        renderContent(appState.content)
    }

    function renderTitle(title) {
        const titleDOM = document.getElementById('title');
        titleDOM.innerHTML = title.text;
        titleDOM.style.color = title.color;
    }

    function renderContent(content) {
        const contentDOM = document.getElementById('content');
        contentDOM.innerHTML = content.text;
        contentDOM.style.color = content.color;
    }

    const appState = {
        title: {
            text: 'React.js 小书',
            color: 'red',
        },
        content: {
            text: 'React.js 小书内容',
            color: 'blue'
        }
    }

    function stateChanger(state, action) {
        switch (action.type) {
            case 'UPDATE_TITLE_TEXT':
                state.title.text = action.text;
                break
            case 'UPDATE_TITLE_COLOR':
                state.title.color = action.color
                break
            default:
                break
        }
    }
    function createStore(state, stateChanger) {
        const listeners = [];
        const subscribe = (listener) => listeners.push(listener);

        const getState = () => state;
        const dispatch = (action) => {
            stateChanger(state, action);
            listeners.forEach(listener => listener());
        }
        return {getState, dispatch, subscribe};
    }

    const store = createStore(appState, stateChanger);
    store.subscribe(() => renderApp(store.getState()));
    store.dispatch({type: 'UPDATE_TITLE_TEXT', text: '《React.js 小书》'});
    store.dispatch({type: 'UPDATE_TITLE_COLOR', color: 'blue'});
</script>
</body>
</html>